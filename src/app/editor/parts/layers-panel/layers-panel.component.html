<div id="layers-panel-root" class="p-2 text-sm relative">
  <div id="layers-list-heading" class="font-semibold mb-2">
    {{ "editor.layers.title" | transloco }}
  </div>
  <div id="layers-list-container" class="flex flex-col gap-1">
    @for (layer of document.layers(); let layerIndex = $index; track layer.id) {
      <div
        id="layers-list-item-{{ layer.id }}"
        class="px-2 py-1 rounded-sm border border-neutral-300 dark:border-neutral-700 flex items-center"
        draggable="true"
        (dragstart)="onDragStart($event, layerIndex)"
        (dragover)="onDragOver($event, layerIndex)"
        (drop)="onDrop($event, layerIndex)"
        (contextmenu)="onContextMenu($event, layer.id)"
        [class]="
          isSelected(layer.id)
            ? 'px-2 py-1 rounded-sm border border-neutral-300 dark:border-neutral-700 flex items-center bg-neutral-200 dark:bg-neutral-700'
            : 'px-2 py-1 rounded-sm border border-neutral-300 dark:border-neutral-700 flex items-center hover:bg-neutral-200/60 dark:hover:bg-neutral-700/60'
        "
      >
        <div
          id="layers-list-item-handle-{{ layer.id }}"
          class="w-4 h-6 flex items-center justify-center cursor-grab mr-2"
        >
          <ng-icon
            id="layers-list-item-handle-icon-{{ layer.id }}"
            name="featherAlignJustify"
            class="w-4 h-4"
          ></ng-icon>
        </div>
        <button
          type="button"
          id="layers-list-item-visibility-{{ layer.id }}"
          class="w-6 h-6 rounded-sm border border-neutral-300 dark:border-neutral-700 grid place-items-center"
          (click)="document.toggleLayerVisibility(layer.id)"
          [title]="
            layer.visible
              ? ('editor.layers.hide' | transloco)
              : ('editor.layers.show' | transloco)
          "
        >
          <ng-icon
            id="layers-list-item-visibility-icon-{{ layer.id }}"
            [name]="layer.visible ? 'featherEye' : 'featherEyeOff'"
            class="w-4 h-4"
          ></ng-icon>
        </button>
        <button
          type="button"
          id="layers-list-item-select-{{ layer.id }}"
          class="flex-1 text-left ml-2"
          (click)="select(layer.id, $event)"
        >
          <span
            id="layers-list-item-name-{{ layer.id }}"
            class="truncate opacity-90"
            >{{ layer.name }}</span
          >
        </button>
        <button
          type="button"
          id="layers-list-item-delete-{{ layer.id }}"
          class="w-6 h-6 rounded-sm border border-neutral-300 dark:border-neutral-700 grid place-items-center disabled:opacity-50 ml-2"
          (click)="document.removeLayer(layer.id)"
          [disabled]="document.layers().length <= 1"
          [title]="'editor.layers.delete' | transloco"
        >
          <ng-icon
            id="layers-list-item-delete-icon-{{ layer.id }}"
            name="featherTrash"
            class="w-4 h-4"
          ></ng-icon>
        </button>
      </div>
    }
  </div>

  <div id="layers-add-row" class="mt-3">
    <button
      type="button"
      id="layers-add-button"
      class="w-full h-8 rounded-sm border border-neutral-300 dark:border-neutral-700 flex items-center justify-center gap-2"
      (click)="onAddLayer()"
      [title]="'editor.layers.add' | transloco"
    >
      <ng-icon id="layers-add-icon" name="plus" class="w-4 h-4"></ng-icon>
      <span id="layers-add-label" class="text-sm">{{
        "editor.layers.add" | transloco
      }}</span>
    </button>
  </div>

  @if (contextMenuVisible()) {
    <div
      id="layers-context-menu"
      class="absolute z-50 bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-700 rounded-sm shadow-lg min-w-[12rem]"
      [style.left.px]="contextMenuPosition().x"
      [style.top.px]="contextMenuPosition().y"
      (click)="closeContextMenu()"
    >
      <div id="layers-context-menu-list" class="py-1">
        <button
          type="button"
          id="layers-context-menu-select-pixel"
          class="w-full px-3 py-2 text-left text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2"
          (click)="onSelectPixel()"
        >
          <ng-icon
            id="layers-context-menu-select-pixel-icon"
            name="heroIconsSquare2StackMini"
            class="w-4 h-4"
          ></ng-icon>
          <span id="layers-context-menu-select-pixel-label">{{
            "editor.layers.selectPixel" | transloco
          }}</span>
        </button>
        <button
          type="button"
          id="layers-context-menu-duplicate"
          class="w-full px-3 py-2 text-left text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2"
          (click)="onDuplicate()"
        >
          <ng-icon
            id="layers-context-menu-duplicate-icon"
            name="heroIconsDocumentDuplicateMini"
            class="w-4 h-4"
          ></ng-icon>
          <span id="layers-context-menu-duplicate-label">{{
            "editor.layers.duplicate" | transloco
          }}</span>
          <span
            id="layers-context-menu-duplicate-shortcut"
            class="ml-auto text-xs opacity-60"
            >Ctrl+D</span
          >
        </button>
        @if (selectedCount >= 2) {
          <button
            type="button"
            id="layers-context-menu-merge"
            class="w-full px-3 py-2 text-left text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2"
            (click)="onMerge()"
          >
            <ng-icon
              id="layers-context-menu-merge-icon"
              name="heroIconsRectangleStackMini"
              class="w-4 h-4"
            ></ng-icon>
            <span id="layers-context-menu-merge-label">{{
              "editor.layers.merge" | transloco
            }}</span>
          </button>
          <button
            type="button"
            id="layers-context-menu-group"
            class="w-full px-3 py-2 text-left text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2"
            (click)="onGroup()"
          >
            <ng-icon
              id="layers-context-menu-group-icon"
              name="heroIconsFolderMini"
              class="w-4 h-4"
            ></ng-icon>
            <span id="layers-context-menu-group-label">{{
              "editor.layers.group" | transloco
            }}</span>
            <span
              id="layers-context-menu-group-shortcut"
              class="ml-auto text-xs opacity-60"
              >Ctrl+G</span
            >
          </button>
        }
        <button
          type="button"
          id="layers-context-menu-delete"
          class="w-full px-3 py-2 text-left text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2"
          (click)="onDelete()"
          [disabled]="document.layers().length <= 1"
        >
          <ng-icon
            id="layers-context-menu-delete-icon"
            name="heroIconsTrashMini"
            class="w-4 h-4"
          ></ng-icon>
          <span id="layers-context-menu-delete-label">{{
            "editor.layers.delete" | transloco
          }}</span>
          <span
            id="layers-context-menu-delete-shortcut"
            class="ml-auto text-xs opacity-60"
            >Del</span
          >
        </button>
      </div>
    </div>
  }
</div>
