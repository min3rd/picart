<div
  id="tool-palette-root"
  class="flex h-full flex-col bg-neutral-100/10 dark:bg-neutral-900/40"
>
  <div
    id="tool-palette-grid"
    class="grid grid-cols-2 gap-2 p-2 text-xs sm:grid-cols-3"
  >
    @for (t of tools.tools(); track t.id) {
      <button
        id="tool-palette-button-{{ t.id }}"
        type="button"
        (click)="select(t.id)"
        class="flex aspect-square w-full items-center justify-center rounded-lg border border-neutral-200/70 bg-neutral-50/60 text-neutral-600 transition-colors hover:bg-neutral-200/70 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-0 dark:border-neutral-700/70 dark:bg-neutral-900/60 dark:text-neutral-200"
        [class]="
          tools.currentTool() === t.id
            ? 'border-blue-500 bg-neutral-200/80 text-neutral-900 shadow-sm dark:bg-neutral-700/70 dark:text-neutral-50'
            : ''
        "
        title="{{ t.labelKey ? (t.labelKey | transloco) : t.name }}"
      >
        <ng-icon
          id="tool-palette-button-icon-{{ t.id }}"
          [name]="t.icon || ''"
          class="h-5 w-5"
        ></ng-icon>
        <span id="tool-palette-button-label-{{ t.id }}" class="sr-only">
          {{ t.labelKey ? (t.labelKey | transloco) : t.name }}
        </span>
      </button>
    }
  </div>

  <div
    id="tool-palette-config"
    class="flex-1 space-y-3 overflow-y-auto border-t border-neutral-200/60 px-2 pb-3 pt-3 dark:border-neutral-800/60"
  >
    @switch (tools.currentTool()) {
      @case ("fill") {
        <section
          id="palette-fill-panel"
          class="rounded-md border border-neutral-200/60 bg-neutral-50/60 p-3 dark:border-neutral-700/60 dark:bg-neutral-900/60"
        >
          <header
            id="palette-fill-heading"
            class="flex items-center gap-2 text-xs uppercase tracking-[0.14em] text-neutral-500 dark:text-neutral-300"
          >
            <ng-icon
              id="palette-fill-heading-icon"
              name="bootstrapPaintBucket"
              class="h-4 w-4"
            ></ng-icon>
            <span id="palette-fill-heading-label">{{
              "editor.tools.fill.title" | transloco
            }}</span>
          </header>
          <div id="palette-fill-content" class="mt-3 space-y-3">
            <div id="palette-fill-mode-row" class="flex items-center gap-2">
              <ng-icon
                id="palette-fill-mode-icon"
                name="bootstrapMagic"
                class="h-4 w-4 text-neutral-500 dark:text-neutral-300"
              ></ng-icon>
              <div
                id="palette-fill-mode-toggle"
                class="flex gap-1 rounded-md bg-neutral-200/50 p-1 dark:bg-neutral-800/50"
              >
                <button
                  id="palette-fill-mode-button-color"
                  type="button"
                  class="flex h-8 w-8 items-center justify-center rounded-sm text-neutral-600 transition-colors hover:bg-white/70 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-0 dark:text-neutral-200 dark:hover:bg-neutral-700/70"
                  [class]="
                    tools.fillMode() === 'color'
                      ? 'bg-white text-neutral-900 shadow-sm dark:bg-neutral-700 dark:text-neutral-50'
                      : ''
                  "
                  (click)="setFillMode('color')"
                  [attr.aria-pressed]="tools.fillMode() === 'color'"
                >
                  <ng-icon
                    id="palette-fill-mode-button-color-icon"
                    name="bootstrapDropletFill"
                    class="h-4 w-4"
                  ></ng-icon>
                  <span
                    id="palette-fill-mode-button-color-label"
                    class="sr-only"
                  >
                    {{ "editor.tools.fill.useColor" | transloco }}
                  </span>
                </button>
                <button
                  id="palette-fill-mode-button-erase"
                  type="button"
                  class="flex h-8 w-8 items-center justify-center rounded-sm text-neutral-600 transition-colors hover:bg-white/70 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-0 dark:text-neutral-200 dark:hover:bg-neutral-700/70"
                  [class]="
                    tools.fillMode() === 'erase'
                      ? 'bg-white text-neutral-900 shadow-sm dark:bg-neutral-700 dark:text-neutral-50'
                      : ''
                  "
                  (click)="setFillMode('erase')"
                  [attr.aria-pressed]="tools.fillMode() === 'erase'"
                >
                  <ng-icon
                    id="palette-fill-mode-button-erase-icon"
                    name="bootstrapEraser"
                    class="h-4 w-4"
                  ></ng-icon>
                  <span
                    id="palette-fill-mode-button-erase-label"
                    class="sr-only"
                  >
                    {{ "editor.tools.fill.erase" | transloco }}
                  </span>
                </button>
              </div>
            </div>
            @if (tools.fillMode() === "color") {
              <div
                id="palette-fill-color-row"
                class="grid grid-cols-[auto,auto,1fr] items-center gap-2"
              >
                <ng-icon
                  id="palette-fill-color-icon"
                  name="bootstrapDroplet"
                  class="h-4 w-4 text-neutral-500 dark:text-neutral-300"
                ></ng-icon>
                <div
                  id="palette-fill-color-input-wrap"
                  class="flex items-center"
                >
                  <label
                    id="palette-fill-color-label"
                    class="sr-only"
                    for="palette-fill-color-input"
                  >
                    {{ "editor.tools.fill.color" | transloco }}
                  </label>
                  <input
                    id="palette-fill-color-input"
                    type="color"
                    [value]="tools.fillColor()"
                    (input)="onFillColorInput($event)"
                    class="h-9 w-10 rounded border border-neutral-300/70 bg-white p-0 dark:border-neutral-700/70 dark:bg-neutral-900"
                  />
                </div>
                <div
                  id="palette-fill-color-value"
                  class="rounded-sm bg-neutral-200/50 px-2 py-1 text-xs font-mono text-neutral-700 dark:bg-neutral-800/60 dark:text-neutral-200"
                >
                  {{ tools.fillColor() }}
                </div>
              </div>
            }
          </div>
        </section>
      }
      @case ("brush") {
        <section
          id="palette-brush-panel"
          class="rounded-md border border-neutral-200/60 bg-neutral-50/60 p-3 dark:border-neutral-700/60 dark:bg-neutral-900/60"
        >
          <header
            id="palette-brush-heading"
            class="flex items-center gap-2 text-xs uppercase tracking-[0.14em] text-neutral-500 dark:text-neutral-300"
          >
            <ng-icon
              id="palette-brush-heading-icon"
              name="bootstrapBrush"
              class="h-4 w-4"
            ></ng-icon>
            <span id="palette-brush-heading-label">{{
              "editor.tools.brush.title" | transloco
            }}</span>
          </header>
          <div id="palette-brush-content" class="mt-3 space-y-3">
            <div
              id="palette-brush-size-row"
              class="grid grid-cols-[auto,1fr,auto] items-center gap-2"
            >
              <ng-icon
                id="palette-brush-size-icon"
                name="bootstrapRulers"
                class="h-4 w-4 text-neutral-500 dark:text-neutral-300"
              ></ng-icon>
              <div
                id="palette-brush-size-input-wrap"
                class="flex w-full items-center"
              >
                <label
                  id="palette-brush-size-label"
                  class="sr-only"
                  for="palette-brush-size-range"
                >
                  {{ "editor.tools.brush.size" | transloco }}
                </label>
                <input
                  id="palette-brush-size-range"
                  type="range"
                  min="1"
                  [max]="maxCanvasDim"
                  [value]="tools.brushSize()"
                  (input)="onBrushSizeInput($event)"
                  class="w-full accent-blue-500"
                />
              </div>
              <input
                id="palette-brush-size-number"
                type="number"
                min="1"
                [attr.max]="maxCanvasDim"
                [value]="tools.brushSize()"
                (input)="onBrushSizeInput($event)"
                class="w-14 rounded border border-neutral-300/70 bg-white px-2 py-1 text-xs text-right dark:border-neutral-700/70 dark:bg-neutral-900 dark:text-neutral-100"
              />
            </div>
            <div
              id="palette-brush-color-row"
              class="grid grid-cols-[auto,auto,1fr] items-center gap-2"
            >
              <ng-icon
                id="palette-brush-color-icon"
                name="bootstrapDroplet"
                class="h-4 w-4 text-neutral-500 dark:text-neutral-300"
              ></ng-icon>
              <div
                id="palette-brush-color-input-wrap"
                class="flex items-center"
              >
                <label
                  id="palette-brush-color-label"
                  class="sr-only"
                  for="palette-brush-color-input"
                >
                  {{ "editor.tools.brush.color" | transloco }}
                </label>
                <input
                  id="palette-brush-color-input"
                  type="color"
                  [value]="tools.brushColor()"
                  (input)="onBrushColorInput($event)"
                  class="h-9 w-10 rounded border border-neutral-300/70 bg-white p-0 dark:border-neutral-700/70 dark:bg-neutral-900"
                />
              </div>
              <div
                id="palette-brush-color-value"
                class="rounded-sm bg-neutral-200/50 px-2 py-1 text-xs font-mono text-neutral-700 dark:bg-neutral-800/60 dark:text-neutral-200"
              >
                {{ tools.brushColor() }}
              </div>
            </div>
          </div>
        </section>
      }
      @case ("line") {
        <section
          id="palette-line-panel"
          class="rounded-md border border-neutral-200/60 bg-neutral-50/60 p-3 dark:border-neutral-700/60 dark:bg-neutral-900/60"
        >
          <header
            id="palette-line-heading"
            class="flex items-center gap-2 text-xs uppercase tracking-[0.14em] text-neutral-500 dark:text-neutral-300"
          >
            <ng-icon
              id="palette-line-heading-icon"
              name="bootstrapSlashLg"
              class="h-4 w-4"
            ></ng-icon>
            <span id="palette-line-heading-label">{{
              "editor.tools.line.title" | transloco
            }}</span>
          </header>
          <div id="palette-line-content" class="mt-3 space-y-3">
            <div
              id="palette-line-thickness-row"
              class="grid grid-cols-[auto,1fr,auto] items-center gap-2"
            >
              <ng-icon
                id="palette-line-thickness-icon"
                name="bootstrapArrowsVertical"
                class="h-4 w-4 text-neutral-500 dark:text-neutral-300"
              ></ng-icon>
              <div
                id="palette-line-thickness-input-wrap"
                class="flex w-full items-center"
              >
                <label
                  id="palette-line-thickness-label"
                  class="sr-only"
                  for="palette-line-thickness-range"
                >
                  {{ "editor.tools.line.thickness" | transloco }}
                </label>
                <input
                  id="palette-line-thickness-range"
                  type="range"
                  min="1"
                  [max]="maxCanvasDim"
                  [value]="tools.lineThickness()"
                  (input)="onLineThicknessInput($event)"
                  class="w-full accent-blue-500"
                />
              </div>
              <input
                id="palette-line-thickness-number"
                type="number"
                min="1"
                [attr.max]="maxCanvasDim"
                [value]="tools.lineThickness()"
                (input)="onLineThicknessInput($event)"
                class="w-14 rounded border border-neutral-300/70 bg-white px-2 py-1 text-xs text-right dark:border-neutral-700/70 dark:bg-neutral-900 dark:text-neutral-100"
              />
            </div>
            <div
              id="palette-line-color-row"
              class="grid grid-cols-[auto,auto,1fr] items-center gap-2"
            >
              <ng-icon
                id="palette-line-color-icon"
                name="bootstrapDroplet"
                class="h-4 w-4 text-neutral-500 dark:text-neutral-300"
              ></ng-icon>
              <div id="palette-line-color-input-wrap" class="flex items-center">
                <label
                  id="palette-line-color-label"
                  class="sr-only"
                  for="palette-line-color-input"
                >
                  {{ "editor.tools.line.color" | transloco }}
                </label>
                <input
                  id="palette-line-color-input"
                  type="color"
                  [value]="tools.lineColor()"
                  (input)="onLineColorInput($event)"
                  class="h-9 w-10 rounded border border-neutral-300/70 bg-white p-0 dark:border-neutral-700/70 dark:bg-neutral-900"
                />
              </div>
              <div
                id="palette-line-color-value"
                class="rounded-sm bg-neutral-200/50 px-2 py-1 text-xs font-mono text-neutral-700 dark:bg-neutral-800/60 dark:text-neutral-200"
              >
                {{ tools.lineColor() }}
              </div>
            </div>
          </div>
        </section>
      }
      @default {
        <section
          id="palette-empty-state"
          class="rounded-md border border-dashed border-neutral-200/70 p-4 text-center text-xs text-neutral-400 dark:border-neutral-700 dark:text-neutral-600"
        >
          {{ "editor.tools.noConfiguration" | transloco }}
        </section>
      }
    }
  </div>
</div>
