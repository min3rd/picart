<div class="h-full w-full relative">
  <div class="absolute inset-0 p-4">
    <div class="relative mx-auto" style="width: max-content">
      <div class="canvas-wrap">
        <div
          class="transform-origin-center"
          [style.transform]="
            'translate(' +
            panX() +
            'px,' +
            panY() +
            'px) scale(' +
            scale() +
            ') rotate(' +
            rotation() +
            'deg)'
          "
        >
          <canvas
            #canvasEl
            [attr.width]="state.canvasWidth()"
            [attr.height]="state.canvasHeight()"
            class="border border-neutral-300 dark:border-neutral-700 block"
            (pointermove)="onPointerMove($event)"
            (pointerdown)="onPointerDown($event)"
            (pointerup)="onPointerUp($event)"
            (pointerleave)="onPointerLeave()"
            (contextmenu)="$event.preventDefault()"
            (wheel)="onWheel($event)"
          ></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Mouse coordinates -->
  <div
    class="absolute left-2 top-2 text-xs text-neutral-700 dark:text-neutral-300 bg-neutral-50/80 dark:bg-neutral-900/60 rounded-sm p-1"
  >
    X: <strong>{{ mouseX() ?? '-' }}</strong> Y: <strong>{{ mouseY() ?? '-' }}</strong>
  </div>

  <!-- Info panel -->
  @if (infoVisible()) {
  <div
    class="absolute right-2 top-2 text-sm p-2 bg-neutral-50/90 dark:bg-neutral-900/70 rounded-sm shadow-sm"
  >
    <div class="flex items-center gap-2">
      <div class="text-xs opacity-80">{{ 'canvas.size' | transloco }}</div>
      <div class="ml-auto flex items-center gap-2">
        <button
          type="button"
          class="w-6 h-6 grid place-items-center"
          (click)="infoVisible.set(!infoVisible())"
        >
          <ng-icon name="eye" class="w-4 h-4"></ng-icon>
        </button>
      </div>
    </div>
    <div class="mt-2 text-xs">
      <div class="flex items-center gap-2">
        <span>{{ 'canvas.width' | transloco }}:</span>
        <input
          type="number"
          [value]="state.canvasWidth()"
          (input)="setCanvasWidth($event)"
          class="w-12 text-xs border rounded px-1"
          min="1"
          max="1024"
        />
      </div>
      <div class="flex items-center gap-2">
        <span>{{ 'canvas.height' | transloco }}:</span>
        <input
          type="number"
          [value]="state.canvasHeight()"
          (input)="setCanvasHeight($event)"
          class="w-12 text-xs border rounded px-1"
          min="1"
          max="1024"
        />
      </div>
      <div>
        {{ 'canvas.saved' | transloco }}:
        {{ state.canvasSaved() ? ('yes' | transloco) : ('no' | transloco) }}
      </div>
    </div>
  </div>
  }

  <!-- Always-visible opener when panel hidden -->
  @if (!infoVisible()) {
  <div class="absolute right-2 top-2">
    <button
      type="button"
      class="w-8 h-8 p-1 bg-neutral-100 dark:bg-neutral-800 rounded-sm shadow-sm"
      (click)="infoVisible.set(true)"
      aria-label="Open info"
    >
      <ng-icon name="eye" class="w-5 h-5 text-neutral-800 dark:text-neutral-200"></ng-icon>
    </button>
  </div>
  }

  <!-- Bottom-right: Zoom slider + rotation display/reset -->
  <div
    class="absolute right-2 bottom-2 flex items-center gap-3 bg-neutral-50/70 dark:bg-neutral-900/60 rounded-sm p-2 shadow-sm"
  >
    <div class="flex items-center gap-2">
      <label class="text-xs opacity-80">{{ 'canvas.zoom' | transloco }}</label>
      <button
        type="button"
        class="w-7 h-7 grid place-items-center bg-neutral-100 dark:bg-neutral-800 rounded-sm"
        (click)="decreaseZoom()"
        aria-label="{{ 'canvas.zoomDecrease' | transloco }}"
      >
        <ng-icon name="minus" class="w-4 h-4"></ng-icon>
      </button>
      <input
        type="range"
        min="0.01"
        [max]="maxScale"
        step="0.01"
        [value]="scale()"
        (input)="onScaleInput($event)"
        class="w-40"
      />
      <button
        type="button"
        class="w-7 h-7 grid place-items-center bg-neutral-100 dark:bg-neutral-800 rounded-sm"
        (click)="increaseZoom()"
        aria-label="{{ 'canvas.zoomIncrease' | transloco }}"
      >
        <ng-icon name="plus" class="w-4 h-4"></ng-icon>
      </button>
      <div class="text-xs ml-2 w-14 text-right">{{ scale().toFixed(2) }}x</div>
    </div>

    <div class="h-6 border-l border-neutral-200 dark:border-neutral-700"></div>

    <div class="flex items-center gap-2">
      <div class="text-xs opacity-80">{{ 'canvas.rotate' | transloco }}</div>
      <div class="text-xs w-12 text-right">{{ rotation().toFixed(0) }}Â°</div>
      <button
        type="button"
        class="w-7 h-7 grid place-items-center bg-neutral-100 dark:bg-neutral-800 rounded-sm"
        (click)="resetRotation()"
        [title]="'canvas.resetRotation' | transloco"
      >
        <ng-icon name="arrow-path" class="w-4 h-4"></ng-icon>
      </button>
    </div>
  </div>
</div>
